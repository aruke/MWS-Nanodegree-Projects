"use strict";$(document).ready(function(){var t=this,r={restaurant:{},map:null,init:function(e){r.restaurant=e,r.initMap(e),r.fillRestaurantHTML(e),$("#breadcrumb").append($("<li>",{text:e.name})),$(window).keydown(function(e){if(13===e.keyCode)return e.preventDefault(),!1}),$("#review-form").submit(function(e){e.preventDefault(),r.submitReview(e)})},initMap:function(e){t.map=L.map("map",{center:[e.latlng.lat,e.latlng.lng],zoom:16,scrollWheelZoom:!1}),L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}",{mapboxToken:MAPBOX_API_KEY,maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox.streets"}).addTo(t.map),Helpers.map.mapMarkerForRestaurant(e,t.map)},fillRestaurantHTML:function(e){document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;var t=document.getElementById("restaurant-img");t.className="restaurant-img",t.src=Helpers.ui.imgSrc(e),t.srcSet=Helpers.ui.imgSrcSet(e),t.alt=e.name+" Restaurant",document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&r.fillRestaurantHoursHTML(e.operating_hours)},fillRestaurantHoursHTML:function(e){var t=document.getElementById("restaurant-hours");for(var n in e){var a=document.createElement("tr"),r=document.createElement("td");r.innerHTML=n,a.appendChild(r);var i=document.createElement("td");i.innerHTML=e[n],a.appendChild(i),t.appendChild(a)}},fillReviewsHTML:function(e){var t=document.getElementById("reviews-container");if(!e){var n=document.createElement("p");return n.innerHTML="No reviews yet!",void t.appendChild(n)}for(var a=document.getElementById("reviews-list");a.firstChild;)a.removeChild(a.firstChild);e.forEach(function(e){a.appendChild(r.createReviewHTML(e))}),t.appendChild(a)},createReviewHTML:function(e){var t=document.createElement("li"),n=document.createElement("p");n.innerHTML=e.name,t.appendChild(n);var a=new Date(e.updatedAt).toLocaleDateString("us-EN",{weekday:"short",year:"numeric",month:"short",day:"numeric"}),r=document.createElement("p");r.innerHTML=a,t.appendChild(r);var i=document.createElement("p");i.innerHTML="Rating: ".concat(e.rating),t.appendChild(i);var o=document.createElement("p");return o.innerHTML=e.comments,t.appendChild(o),t},submitReview:function(e){var t,n,a;""!=$("#name").val()?(t=$("#name").val(),""!=$("#review").val()?(n=$("#review").val(),a=parseInt($("input[name='ratings']:checked").val()),Helpers.network.reviews.addForRestaurant(parseInt(i),t,n,a).then(function(e){console.log(e),Helpers.db.reviews.getForRestaurant(i).then(function(e){var n;$("#name").val(""),$("#review").val(""),$("input[name='ratings']").each(function(e,t){t.checked=!1,n=t}),n.checked=!0,r.fillReviewsHTML(e)})})):M.toast({html:"Please enter review.",classes:"rounded"})):M.toast({html:"Please enter your name.",classes:"rounded"})}},i=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]".concat(e,"(=([^&#]*)|&|#|$)")).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}("id");i||(console.error("No restaurant id in URL"),i=1),Helpers.db.restaurants.getById(i).then(function(e){r.init(e)}).catch(function(e){console.error(e)}),Helpers.network.reviews.getForRestaurant(i).then(function(e){Helpers.db.reviews.addAll(e),r.fillReviewsHTML(e)}).catch(function(e){Helpers.db.reviews.getForRestaurant(i).then(function(e){r.fillReviewsHTML(e)}).then(function(e){})}),M.AutoInit()});