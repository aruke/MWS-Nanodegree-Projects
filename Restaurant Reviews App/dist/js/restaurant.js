"use strict";$(document).ready(function(){var t=this,o={restaurant:{},map:null,init:function(e){o.restaurant=e,o.initMap(e),o.fillRestaurantHTML(e),$("#breadcrumb").append($("<li>",{text:e.name})),$(window).keydown(function(e){if(13===e.keyCode)return e.preventDefault(),!1}),$("#review-form").submit(function(e){e.preventDefault(),o.submitReview(e)})},initMap:function(e){t.map=L.map("map",{center:[e.latlng.lat,e.latlng.lng],zoom:16,scrollWheelZoom:!1}),L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}",{mapboxToken:MAPBOX_API_KEY,maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox.streets"}).addTo(t.map),Helpers.map.mapMarkerForRestaurant(e,t.map)},fillRestaurantHTML:function(e){document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;var t=document.getElementById("restaurant-img");t.className="restaurant-img",t.src=Helpers.ui.imgSrc(e),t.srcSet=Helpers.ui.imgSrcSet(e),t.alt=e.name+" Restaurant",document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&o.fillRestaurantHoursHTML(e.operating_hours)},fillRestaurantHoursHTML:function(e){var t=document.getElementById("restaurant-hours");for(var n in e){var a=document.createElement("tr"),r=document.createElement("td");r.innerHTML=n,a.appendChild(r);var i=document.createElement("td");i.innerHTML=e[n],a.appendChild(i),t.appendChild(a)}},fillReviewsHTML:function(e){var t=document.getElementById("reviews-container");if(!e){var n=document.createElement("p");return n.innerHTML="No reviews yet!",void t.appendChild(n)}for(var a=document.getElementById("reviews-list");a.firstChild;)a.removeChild(a.firstChild);e.forEach(function(e){a.appendChild(o.createReviewHTML(e))}),t.appendChild(a)},createReviewHTML:function(e){var t=document.createElement("li"),n=document.createElement("p");n.innerHTML=e.name,t.appendChild(n);var a=new Date(e.updatedAt).toLocaleDateString("us-EN",{weekday:"short",year:"numeric",month:"short",day:"numeric"}),r=document.createElement("p");r.innerHTML=a,t.appendChild(r);var i=document.createElement("p");i.innerHTML="Rating: ".concat(e.rating),t.appendChild(i);var o=document.createElement("p");return o.innerHTML=e.comments,t.appendChild(o),t},submitReview:function(e){var t,n,a;if(""!=$("#name").val())if(t=$("#name").val(),""!=$("#review").val()){n=$("#review").val(),a=parseInt($("input[name='ratings']:checked").val());var r=navigator.onLine;if(r&&!0===r)Helpers.network.reviews.addForRestaurant(parseInt(s),t,n,a).then(function(e){console.log(e),Helpers.db.reviews.getForRestaurant(s).then(function(e){var n;$("#name").val(""),$("#review").val(""),$("input[name='ratings']").each(function(e,t){t.checked=!1,n=t}),n.checked=!0,o.fillReviewsHTML(e)})});else{var i={restaurant_id:parseInt(s),name:t,rating:n,comments:a};Helpers.db.pendingReview.add(i).then(function(e){var n;M.toast({html:"No Network! Your review will be added when network is available.",classes:"rounded"}),$("#name").val(""),$("#review").val(""),$("input[name='ratings']").each(function(e,t){t.checked=!1,n=t}),n.checked=!0}).catch(function(e){M.toast({html:"Error! ＼(￣O￣)",classes:"rounded"})})}}else M.toast({html:"Please enter review.",classes:"rounded"});else M.toast({html:"Please enter your name.",classes:"rounded"})}},s=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]".concat(e,"(=([^&#]*)|&|#|$)")).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}("id");s||(console.error("No restaurant id in URL"),s=1),Helpers.db.restaurants.getById(s).then(function(e){o.init(e)}).catch(function(e){console.error(e)}),Helpers.network.reviews.getForRestaurant(s).then(function(e){Helpers.db.reviews.addAll(e),o.fillReviewsHTML(e)}).catch(function(e){Helpers.db.reviews.getForRestaurant(s).then(function(e){o.fillReviewsHTML(e)}).then(function(e){})}),M.AutoInit()});